#!/usr/bin/env node

'use strict';

var program  = require('commander');
var Table    = require('cli-table');
var chalk    = require('chalk');
var pkg      = require('../package.json');
var consulta = require('../.');

var error = chalk.bold.red;

program
  .version(pkg.version)
  .usage('zipcode')
  .description('Search address using zip code')
  .arguments('<zipcode>')
  .action(function run(zipcode) {
    consulta(zipcode)
      .then(function success(res) {
        delete res.success;
        var heads = Object.keys(res);
        var values = heads.map(function getValues(k) {
          return res[k];
        });
        var table = new Table({
          head: heads,
        });
        table.push(values);
        process.stdout.write(table.toString() + '\n');
        process.exit();
      })
      .catch(function fail(err) {
        process.stdout.write(error('\u2716 ') + err.message + '\n');
        process.exit(1);
      });
  })
  .parse(process.argv);

if (!program.args.length) {
  program.help();
}
